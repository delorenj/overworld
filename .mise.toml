[tools]
python = "3.12"
node = "20"

[env]
_.file = [".env"]

[tasks.dev]
description = "Start all services with Docker Compose"
run = "docker compose up --build"

[tasks.dev-detached]
description = "Start all services in detached mode"
run = "docker compose up -d --build"

[tasks.down]
description = "Stop all services"
run = "docker compose down"

[tasks.logs]
description = "Follow logs from all services"
run = "docker compose logs -f"

[tasks.migrate]
description = "Run database migrations"
run = "docker compose exec backend alembic upgrade head"

[tasks.migrate-create]
description = "Create a new migration"
run = "docker compose exec backend alembic revision --autogenerate -m \"$1\""

[tasks.migrate-rollback]
description = "Rollback last migration"
run = "docker compose exec backend alembic downgrade -1"

[tasks.seed]
description = "Seed database with test data"
run = "docker compose exec backend python scripts/seed_db.py"

[tasks.test]
description = "Run backend tests"
run = "docker compose exec backend pytest"

[tasks.test-cov]
description = "Run backend tests with coverage"
run = "docker compose exec backend pytest --cov=app --cov-report=html --cov-report=term"

[tasks.lint]
description = "Run linting on backend"
run = "docker compose exec backend ruff check ."

[tasks.lint-fix]
description = "Run linting with auto-fix on backend"
run = "docker compose exec backend ruff check --fix ."

[tasks.format]
description = "Format backend code"
run = "docker compose exec backend ruff format ."

[tasks.frontend-lint]
description = "Run linting on frontend"
run = "docker compose exec frontend npm run lint"

[tasks.frontend-format]
description = "Format frontend code"
run = "docker compose exec frontend npm run format"

[tasks.shell-backend]
description = "Open shell in backend container"
run = "docker compose exec backend /bin/bash"

[tasks.shell-db]
description = "Open psql shell in database"
run = "docker compose exec postgres psql -U overworld -d overworld"

[tasks.clean]
description = "Clean up containers, volumes, and caches"
run = "docker compose down -v && rm -rf backend/.cache frontend/.cache"

[tasks.rebuild]
description = "Rebuild all containers from scratch"
run = "docker compose down && docker compose build --no-cache && docker compose up"
